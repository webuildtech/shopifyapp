(()=>{var r={740:function(t){function u(t,e){if(!(this instanceof u))return new u(t,e);e=Object.assign({},n,e);var r=Math.pow(10,e.precision);this.intValue=t=i(t,e),this.value=t/r,e.increment=e.increment||1/r,e.groups=e.useVedic?o:a,this.s=e,this.p=r}function i(t,e,r){var i=!(2<arguments.length&&void 0!==r)||r,n=e.decimal,a=e.errorOnInvalid,o=e.fromCents,s=Math.pow(10,e.precision),c=t instanceof u;if(c&&o)return t.intValue;if("number"==typeof t||c)n=c?t.value:t;else if("string"==typeof t)a=new RegExp("[^-\\d"+n+"]","g"),n=new RegExp("\\"+n,"g"),n=t.replace(/\((.*)\)/,"-$1").replace(a,"").replace(n,".")||0;else{if(a)throw Error("Invalid Input");n=0}return o||(n=(n*s).toFixed(4)),i?Math.round(n):n}var n,a,o;t.exports=(n={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:function(t,e){var r=e.pattern,i=e.negativePattern,n=e.symbol,a=e.separator,o=e.decimal;e=e.groups;var s=(c=(""+t).replace(/^-/,"").split("."))[0],c=c[1];return(0<=t.value?r:i).replace("!",n).replace("#",s.replace(e,"$1"+a)+(c?o+c:""))},fromCents:!1},a=/(\d)(?=(\d{3})+\b)/g,o=/(\d)(?=(\d\d)+\d\b)/g,u.prototype={add:function(t){var e=this.s,r=this.p;return u((this.intValue+i(t,e))/(e.fromCents?1:r),e)},subtract:function(t){var e=this.s,r=this.p;return u((this.intValue-i(t,e))/(e.fromCents?1:r),e)},multiply:function(t){var e=this.s;return u(this.intValue*t/(e.fromCents?1:Math.pow(10,e.precision)),e)},divide:function(t){var e=this.s;return u(this.intValue/i(t,e,!1),e)},distribute:function(t){for(var e=this.intValue,r=this.p,i=this.s,n=[],a=Math[0<=e?"floor":"ceil"](e/t),o=Math.abs(e-a*t),r=i.fromCents?1:r;0!==t;t--){var s=u(a/r,i);0<o--&&(s=s[0<=e?"add":"subtract"](1/r)),n.push(s)}return n},dollars:function(){return~~this.value},cents:function(){return~~(this.intValue%this.p)},format:function(t){var e=this.s;return"function"==typeof t?t(this,e):e.format(this,Object.assign({},e,t))},toString:function(){var t=this.s,e=t.increment;return(Math.round(this.intValue/this.p/e)*e).toFixed(t.precision)},toJSON:function(){return this.value}},u)}},i={};function _(t){var e=i[t];return void 0!==e||(e=i[t]={exports:{}},r[t].call(e.exports,e,e.exports,_)),e.exports}(()=>{"use strict";const a=()=>{var t=document.cookie.split("; ").find(t=>t.startsWith("_y="));return t?t.split("=")[1]:null},c=t=>{return t.replace(/[^0-9]/g,"")/100},e=(t,e,r)=>{var i=t.indexOf(e);return-1===i?"":-1===(r=t.indexOf(r,i+e.length))?t.substring(i+e.length):t.substring(i+e.length,r)},o=t=>{return e(t,"/products/","?")};function u(t,e){let r=t.match(/[^0-9,.]+/g);r=null!==r?r[0]:"";var i=t.match(/(\s[A-Z]{3})/),i=i?i[0]:"",n=null!==t.match(/(\d+),(\d{2})($|\s)/),t=null!==t.match(/(\d{1,3})(,\d{3})+/),e=e.toLocaleString(n?"de-DE":"en-US",{minimumFractionDigits:2,maximumFractionDigits:2,useGrouping:t});return""+r+e+i}const l=({formattedPrice:t,formattedDiscountPrice:e,percentage:r})=>`
    <div class="aiupsello-discount">
      <span class="aiupsello-discount__original-price">
        ${t}
      </span>
      <span class="aiupsello-discount__discounted-price">
        ${e}
      </span>
      <span class="aiupsello-discount__percentage">
        -${r}%
      </span>
    </div>
  `,d=t=>`
    <div class="aiupsello-discount">
      ${t}
    </div>
  `,s=t=>"true"===t.getAttribute("data-discounted")||"true"===t.getAttribute("data-loading"),r=i=>{const n=[];return document.querySelectorAll(i.selectors.product.priceContainer).forEach(t=>{var e,r;s(t)||(e=t.querySelector(i.selectors.product.priceInner).innerHTML.trim(),r=AIUpsello.config.product.handle,""!==e&&n.push({priceString:e,element:t,productHandle:r,quantity:1}))}),document.querySelectorAll(i.selectors.cart.priceContainer).forEach(t=>{var e,r;s(t)||(e=t.querySelector(i.selectors.cart.priceInner).innerHTML.trim(),r=t.closest(i.selectors.cart.item).querySelector("a[href*='/products/']").href,r=o(r),""!==e&&n.push({priceString:e,element:t,productHandle:r,quantity:1}))}),document.querySelectorAll(i.selectors.grid.priceContainer).forEach(t=>{var e,r;s(t)||(e=$(t).find(i.selectors.grid.priceInner).html().trim(),console.log(t.closest(i.selectors.grid.item)),r=t.closest(i.selectors.grid.item).querySelector("a[href*='/products/']").href,r=o(r),""!==e&&n.push({priceString:e,element:t,productHandle:r,quantity:1}))}),n},i=t=>`<div class="lds-spinner" style>${"<div></div>".repeat(12)}</div>`,p=async t=>{var e=a();return(await(await fetch(`/apps/api/discounts?clientId=${e}&productHandles[]=`+t.join("&productHandles[]="),{method:"GET"})).json()).discounts};async function n({isBuyItNow:t}){var e,r,i,n=0===AIUpsello.config.cart.items.length;n&&!t||(t&&(r=h(),e=r.productId,i=h(),i={product_id:e,price:i.variantPrice,quantity:1,variant_id:i.variantId},e=await(await fetch(`/apps/api/discounts?clientId=${a()}&productIds[]=${e}&cartItems=`+JSON.stringify([i]),{method:"POST"})).json(),console.log(e.discountCodes[0]),i=await e.discountCodes[0],e=r.variantId,r=r.quantity,window.location.href=`/cart/${e}:${r}?discount=`+i),n)||t||(r=(e=await(await(await fetch("/cart.js")).json()).items.map(t=>({variantId:t.variant_id,quantity:t.quantity,productId:t.product_id,handle:t.handle}))).map(t=>t.productId),i=r,n=await(await fetch("/cart.js")).json(),async function(t,e){let r=t.map(t=>`${t.variantId}:${t.quantity}`).join(",");const i=e.join(",");console.log(`/cart/${r}?discount=${i}`),await $.ajax({url:`/cart/${r}?discount=${i}`,success:async function(t){console.log("Discounts applied");window.location.href=`/checkout`}})}(e,await(i=(await(await fetch(`/apps/api/discounts?clientId=${a()}&productIds[]=`+i.join("&productIds[]=")+"&cartItems="+JSON.stringify(n.items),{method:"POST",headers:{"Content-Type":"application/json"}})).json()).discountCodes)))}const h=function(){const e=document.querySelector('[name="id"][type="hidden"][value]')?.value;if(!e)return null;let t=document.querySelector('[name="quantity"][type="number"]')?.value;t=t||1;var r=AIUpsello?.config?.product?.variants?.find(t=>t.id==e)?.price,i=AIUpsello?.config?.product?.id;return{variantId:e,quantity:t,productId:i,variantPrice:r}};_(740);const f={selectors:{grid:{priceContainer:".product-grid .price",priceInner:".price-item--regular",item:".product-grid .grid__item"},cart:{priceContainer:".cart-item__price-wrapper",priceInner:".price",item:".cart-item",quantity:".quantity__input",subtotal:".totals__subtotal-value"},product:{priceContainer:".product__info-wrapper .price",priceInner:".price-item--regular"}}};var m,g;$("#checkout, #CartDrawer-Checkout").click(async function(t){t.preventDefault(),$(this).attr("type","button"),y($(this)),n({isBuyItNow:!1})}),window.addEventListener("load",async()=>{console.log("AI Upsello - Initialized"),$(".shopify-payment-button *, .shopify-payment-button").click(async function(t){y($(".shopify-payment-button__button")),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),t.cancelBubble=!0,t.returnValue=!1,setTimeout(()=>{n({isBuyItNow:!0})},1e3)}),$(".shopify-payment-button *").css("pointer-events","none"),$(".shopify-payment-button").css("cursor","pointer")});const v=t=>{t.forEach(({element:t})=>{$(t).html(i()),$(t).attr("data-loading","true")}),$(f.selectors.cart.subtotal).html(i()),$(f.selectors.cart.subtotal).attr("data-loading","true")},y=t=>{$(t).html(i())},w=async t=>{const s=await p((t=>{const e=[];return document.querySelectorAll(t.selectors.grid.item+" a[href*='/products/']").forEach(t=>{t=t.getAttribute("href"),t=o(t);e.push(t)}),AIUpsello.config.template.includes("product")&&e.push(""+AIUpsello.config.product.handle),AIUpsello.config.template.includes("cart")&&AIUpsello.config.cart.items.forEach(t=>{e.push(""+t.handle)}),e})(f));t.forEach(({productHandle:e,priceString:t,element:r,quantity:i})=>{var n,a,o=s.find(t=>t.productHandle===e);o&&($(r).html((t=t,o=o,i=i,n=c(t),a=u(t,n*(1-o.discountMultiplier)*i),t=u(t,n*i),o.productDiscountedPrice!==o.productOriginalPrice?l({formattedPrice:t,formattedDiscountPrice:a,percentage:(100*o.discountMultiplier).toFixed(0)}):d(t))),$(r).attr("data-discounted","true"),$(r).attr("data-loading","false"))})},I=async t=>{var t=u(t,await async function(){var t=await(await fetch("/cart.js")).json(),e=t.items.map(t=>t.handle),r=await p(e);let i=0;for(let e of t.items){var n=r.find(t=>t.productHandle===e.handle);n&&(i+=e.original_line_price/100*(1-n.discountMultiplier)),n||(i+=e.original_line_price/100)}return i}()),e=$(f.selectors.cart.subtotal);0<e.length&&(e.html(d(t)),e.attr("data-discounted","true"),e.attr("data-loading","false"))},t=(m=async()=>{var t=r(f),e=$(f.selectors.cart.subtotal).text();console.log("AI Upsello - Mutation detected"),v(t),I(e),w(t)},g=".product-grid, .cart-items, .price, .product",new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{(0<$(t).find(g).length||$(t).is(g))&&m()})})}).observe(document.body,{childList:!0,subtree:!0}),r(f));var b=$(f.selectors.cart.subtotal).text();v(t),I(b),w(t),window.addEventListener("load",async()=>{await w(t)})})()})();